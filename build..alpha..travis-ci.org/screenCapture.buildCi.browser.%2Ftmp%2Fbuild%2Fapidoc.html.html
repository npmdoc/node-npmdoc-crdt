<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="http://github.com/dominictarr/crdt">crdt (v3.6.4)</a>
</h1>
<h4>Commutative Replicated Data Types for easy distributed/collaborative apps</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt">module crdt</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.crdt">
            function <span class="apidocSignatureSpan"></span>crdt
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Doc">
            function <span class="apidocSignatureSpan">crdt.</span>Doc
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row">
            function <span class="apidocSignatureSpan">crdt.</span>Row
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype._set">
            function <span class="apidocSignatureSpan">crdt.</span>Row.prototype._set
            <span class="apidocSignatureSpan">(changes, source)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.get">
            function <span class="apidocSignatureSpan">crdt.</span>Row.prototype.get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.set">
            function <span class="apidocSignatureSpan">crdt.</span>Row.prototype.set
            <span class="apidocSignatureSpan">(changes, v)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.toJSON">
            function <span class="apidocSignatureSpan">crdt.</span>Row.prototype.toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.validate">
            function <span class="apidocSignatureSpan">crdt.</span>Row.prototype.validate
            <span class="apidocSignatureSpan">(changes)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq">
            function <span class="apidocSignatureSpan">crdt.</span>Seq
            <span class="apidocSignatureSpan">(doc, key, val)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.after">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.after
            <span class="apidocSignatureSpan">(obj, after)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.asArray">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.asArray
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.at">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.at
            <span class="apidocSignatureSpan">(i)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.before">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.before
            <span class="apidocSignatureSpan">(obj, before)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.first">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.first
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.indexOf">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.indexOf
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.last">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.last
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.length">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.length
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.next">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.next
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.pop">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.pop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.prev">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.prev
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.push">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.push
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.shift">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.shift
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.unshift">
            function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.unshift
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set">
            function <span class="apidocSignatureSpan">crdt.</span>Set
            <span class="apidocSignatureSpan">(doc, key, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.asArray">
            function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.asArray
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.forEach">
            function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.forEach
            <span class="apidocSignatureSpan">(iter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.get">
            function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.get
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.has">
            function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.has
            <span class="apidocSignatureSpan">(row)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.onEach">
            function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.onEach
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.toJSON">
            function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.createStream">
            function <span class="apidocSignatureSpan">crdt.</span>createStream
            <span class="apidocSignatureSpan">(doc, opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.debug">
            function <span class="apidocSignatureSpan">crdt.</span>debug
            <span class="apidocSignatureSpan">(id, doc)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_">
            function <span class="apidocSignatureSpan">crdt.</span>super_
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype._update">
            function <span class="apidocSignatureSpan">crdt.</span>super_.prototype._update
            <span class="apidocSignatureSpan">(update)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.applyUpdate">
            function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.applyUpdate
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.clone">
            function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.clone
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.createReadStream">
            function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.createReadStream
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.createStream">
            function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.createStream
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.createWriteStream">
            function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.createWriteStream
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.dispose">
            function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.dispose
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.localUpdate">
            function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.localUpdate
            <span class="apidocSignatureSpan">(trx)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.setId">
            function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.setId
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.timestamp">
            function <span class="apidocSignatureSpan">crdt.</span>super_.timestamp
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.updateIsRecent">
            function <span class="apidocSignatureSpan">crdt.</span>super_.updateIsRecent
            <span class="apidocSignatureSpan">(update, sources)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.sync">
            function <span class="apidocSignatureSpan">crdt.</span>sync
            <span class="apidocSignatureSpan">(a, b)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.toString">
            function <span class="apidocSignatureSpan">crdt.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">crdt.</span>Row.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">crdt.</span>Seq.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">crdt.</span>Set.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">crdt.</span>super_.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Row">module crdt.Row</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.Row">
            function <span class="apidocSignatureSpan">crdt.</span>Row
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.super_">
            function <span class="apidocSignatureSpan">crdt.Row.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Row.prototype">module crdt.Row.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype._set">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>_set
            <span class="apidocSignatureSpan">(changes, source)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.get">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.set">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>set
            <span class="apidocSignatureSpan">(changes, v)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.toJSON">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.validate">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>validate
            <span class="apidocSignatureSpan">(changes)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Row.prototype._set">module crdt.Row.prototype._set</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype._set._set">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>_set
            <span class="apidocSignatureSpan">(changes, source)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Row.prototype.get">module crdt.Row.prototype.get</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.get.get">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Row.prototype.set">module crdt.Row.prototype.set</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.set.set">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>set
            <span class="apidocSignatureSpan">(changes, v)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Row.prototype.toJSON">module crdt.Row.prototype.toJSON</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.toJSON.toJSON">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Row.prototype.validate">module crdt.Row.prototype.validate</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Row.prototype.validate.validate">
            function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>validate
            <span class="apidocSignatureSpan">(changes)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq">module crdt.Seq</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.Seq">
            function <span class="apidocSignatureSpan">crdt.</span>Seq
            <span class="apidocSignatureSpan">(doc, key, val)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.super_">
            function <span class="apidocSignatureSpan">crdt.Seq.</span>super_
            <span class="apidocSignatureSpan">(doc, key, value)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype">module crdt.Seq.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.after">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>after
            <span class="apidocSignatureSpan">(obj, after)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.asArray">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>asArray
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.at">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>at
            <span class="apidocSignatureSpan">(i)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.before">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>before
            <span class="apidocSignatureSpan">(obj, before)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.first">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>first
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.indexOf">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>indexOf
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.last">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>last
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.length">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>length
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.next">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>next
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.pop">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>pop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.prev">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>prev
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.push">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>push
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.shift">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>shift
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.unshift">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>unshift
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.after">module crdt.Seq.prototype.after</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.after.after">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>after
            <span class="apidocSignatureSpan">(obj, after)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.asArray">module crdt.Seq.prototype.asArray</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.asArray.asArray">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>asArray
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.at">module crdt.Seq.prototype.at</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.at.at">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>at
            <span class="apidocSignatureSpan">(i)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.before">module crdt.Seq.prototype.before</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.before.before">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>before
            <span class="apidocSignatureSpan">(obj, before)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.first">module crdt.Seq.prototype.first</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.first.first">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>first
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.indexOf">module crdt.Seq.prototype.indexOf</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.indexOf.indexOf">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>indexOf
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.last">module crdt.Seq.prototype.last</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.last.last">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>last
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.length">module crdt.Seq.prototype.length</a><ol>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.next">module crdt.Seq.prototype.next</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.next.next">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>next
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.pop">module crdt.Seq.prototype.pop</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.pop.pop">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>pop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.prev">module crdt.Seq.prototype.prev</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.prev.prev">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>prev
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.push">module crdt.Seq.prototype.push</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.push.push">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>push
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.shift">module crdt.Seq.prototype.shift</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.shift.shift">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>shift
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Seq.prototype.unshift">module crdt.Seq.prototype.unshift</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Seq.prototype.unshift.unshift">
            function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>unshift
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Set">module crdt.Set</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.Set">
            function <span class="apidocSignatureSpan">crdt.</span>Set
            <span class="apidocSignatureSpan">(doc, key, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.super_">
            function <span class="apidocSignatureSpan">crdt.Set.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Set.prototype">module crdt.Set.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.asArray">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>asArray
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.each">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>each
            <span class="apidocSignatureSpan">(iter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.forEach">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>forEach
            <span class="apidocSignatureSpan">(iter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.get">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>get
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.has">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>has
            <span class="apidocSignatureSpan">(row)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.onEach">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>onEach
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.toJSON">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Set.prototype.asArray">module crdt.Set.prototype.asArray</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.asArray.asArray">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>asArray
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Set.prototype.forEach">module crdt.Set.prototype.forEach</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.forEach.forEach">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>forEach
            <span class="apidocSignatureSpan">(iter)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Set.prototype.get">module crdt.Set.prototype.get</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.get.get">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>get
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Set.prototype.has">module crdt.Set.prototype.has</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.has.has">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>has
            <span class="apidocSignatureSpan">(row)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Set.prototype.onEach">module crdt.Set.prototype.onEach</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.onEach.onEach">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>onEach
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.Set.prototype.toJSON">module crdt.Set.prototype.toJSON</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.Set.prototype.toJSON.toJSON">
            function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.createStream">module crdt.createStream</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.createStream.createStream">
            function <span class="apidocSignatureSpan">crdt.</span>createStream
            <span class="apidocSignatureSpan">(doc, opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.debug">module crdt.debug</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.debug.debug">
            function <span class="apidocSignatureSpan">crdt.</span>debug
            <span class="apidocSignatureSpan">(id, doc)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_">module crdt.super_</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.super_">
            function <span class="apidocSignatureSpan">crdt.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.filter">
            function <span class="apidocSignatureSpan">crdt.super_.</span>filter
            <span class="apidocSignatureSpan">(update, sources)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.timestamp">
            function <span class="apidocSignatureSpan">crdt.super_.</span>timestamp
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.updateIsRecent">
            function <span class="apidocSignatureSpan">crdt.super_.</span>updateIsRecent
            <span class="apidocSignatureSpan">(update, sources)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype">module crdt.super_.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype._update">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>_update
            <span class="apidocSignatureSpan">(update)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.applyUpdate">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>applyUpdate
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.clone">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>clone
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.createReadStream">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createReadStream
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.createStream">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createStream
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.createWriteStream">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createWriteStream
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.dispose">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>dispose
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.history">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>history
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.localUpdate">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>localUpdate
            <span class="apidocSignatureSpan">(trx)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.setId">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>setId
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype._update">module crdt.super_.prototype._update</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype._update._update">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>_update
            <span class="apidocSignatureSpan">(update)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype.applyUpdate">module crdt.super_.prototype.applyUpdate</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.applyUpdate.applyUpdate">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>applyUpdate
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype.clone">module crdt.super_.prototype.clone</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.clone.clone">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>clone
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype.createReadStream">module crdt.super_.prototype.createReadStream</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.createReadStream.createReadStream">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createReadStream
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype.createStream">module crdt.super_.prototype.createStream</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.createStream.createStream">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createStream
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype.createWriteStream">module crdt.super_.prototype.createWriteStream</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.createWriteStream.createWriteStream">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createWriteStream
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype.dispose">module crdt.super_.prototype.dispose</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.dispose.dispose">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>dispose
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype.localUpdate">module crdt.super_.prototype.localUpdate</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.localUpdate.localUpdate">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>localUpdate
            <span class="apidocSignatureSpan">(trx)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.prototype.setId">module crdt.super_.prototype.setId</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.prototype.setId.setId">
            function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>setId
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.timestamp">module crdt.super_.timestamp</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.timestamp.timestamp">
            function <span class="apidocSignatureSpan">crdt.super_.</span>timestamp
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.super_.updateIsRecent">module crdt.super_.updateIsRecent</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.super_.updateIsRecent.updateIsRecent">
            function <span class="apidocSignatureSpan">crdt.super_.</span>updateIsRecent
            <span class="apidocSignatureSpan">(update, sources)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.sync">module crdt.sync</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.sync.sync">
            function <span class="apidocSignatureSpan">crdt.</span>sync
            <span class="apidocSignatureSpan">(a, b)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.crdt.toString">module crdt.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.crdt.toString.toString">
            function <span class="apidocSignatureSpan">crdt.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt" id="apidoc.module.crdt">module crdt</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.crdt" id="apidoc.element.crdt.crdt">
        function <span class="apidocSignatureSpan"></span>crdt
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Doc(id) {
  if (!(this instanceof Doc)) return new Doc(id)
  //the id of the doc refers to the instance.
  //that is, to the node.
  //it's used to identify a node
//  this.id = id || '#' + Math.round(Math.random()*1000)
  this.rows = {}
  this.hist = {}
  this.sets = new EventEmitter() //for tracking membership of sets.
  this.setMaxListeners(Infinity)
  this.sets.setMaxListeners(Infinity)
  Scuttlebutt.call(this, id)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Doc" id="apidoc.element.crdt.Doc">
        function <span class="apidocSignatureSpan">crdt.</span>Doc
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Doc(id) {
  if (!(this instanceof Doc)) return new Doc(id)
  //the id of the doc refers to the instance.
  //that is, to the node.
  //it's used to identify a node
//  this.id = id || '#' + Math.round(Math.random()*1000)
  this.rows = {}
  this.hist = {}
  this.sets = new EventEmitter() //for tracking membership of sets.
  this.setMaxListeners(Infinity)
  this.sets.setMaxListeners(Infinity)
  Scuttlebutt.call(this, id)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row" id="apidoc.element.crdt.Row">
        function <span class="apidocSignatureSpan">crdt.</span>Row
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Row(id) {
  this.id = id
  this.state = {id: id}
  this.setMaxListeners(Infinity)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.prototype._set" id="apidoc.element.crdt.Row.prototype._set">
        function <span class="apidocSignatureSpan">crdt.</span>Row.prototype._set
        <span class="apidocSignatureSpan">(changes, source)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Row.prototype._set = function (changes, source) {

  //the change is applied by the Doc!
  this.emit('preupdate', changes, source)
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.get" id="apidoc.element.crdt.Row.prototype.get">
        function <span class="apidocSignatureSpan">crdt.</span>Row.prototype.get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Row.prototype.get = function (key) {
  if(key)
    return this.state[key]
  return this.state
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.set" id="apidoc.element.crdt.Row.prototype.set">
        function <span class="apidocSignatureSpan">crdt.</span>Row.prototype.set
        <span class="apidocSignatureSpan">(changes, v)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Row.prototype.set = function (changes, v) {
  if(arguments.length == 2) {
    var k = changes
    if(k === '__proto__')
      return this
    changes = {}
    changes[k] = v
  }

  if(changes !== null &amp;&amp; changes.id &amp;&amp; changes.id !== this.state.id)
    throw new Error('id cannot be changed')

  this._set(changes, 'local')
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.toJSON" id="apidoc.element.crdt.Row.prototype.toJSON">
        function <span class="apidocSignatureSpan">crdt.</span>Row.prototype.toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Row.prototype.toJSON = function () {
  return this.state
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.validate" id="apidoc.element.crdt.Row.prototype.validate">
        function <span class="apidocSignatureSpan">crdt.</span>Row.prototype.validate
        <span class="apidocSignatureSpan">(changes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Row.prototype.validate = function (changes) {
  try {
    this.emit('validate', changes)
    return true
  } catch (e) {
    console.error('validation', e.message)
    return false
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq" id="apidoc.element.crdt.Seq">
        function <span class="apidocSignatureSpan">crdt.</span>Seq
        <span class="apidocSignatureSpan">(doc, key, val)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Seq(doc, key, val) {
  if(key == '__proto__')
    throw new Error('__proto__ is invalid key')

  Set.call(this, doc, key, val)

  if (typeof key !== 'string') {
    key = null
  }

  var seq = this
  this.on('changes', function (row, changes) {
    if(!changes._sort) return
    sort(seq._array)
    //check if there is already an item with this sort key.
    var prev =
    find(seq._array, function (other) {
      return other != row &amp;&amp; other.get('_sort') == row.get('_sort')
    })

    //nudge it forward if it has the same key.
    if(prev)
      seq.insert(row, prev, seq.next(row))
    else
      seq.emit('move', row)
  })
  this.insert = function (obj, before, after) {

    before = toKey(this.get(before) || '!')
    after  = toKey(this.get(after)  || '~')

    //must get id from the doc,
    //because may be moving this item into this set.
    if('string' === typeof obj)
      obj = doc.rows[obj]

    var _sort =
       between.between(before, after )
     + between.randstr(3) //add a random tail so it's hard
                    //to concurrently add two items with the
                    //same sort.

    var r, changes
    if(obj instanceof Row) {
      r = obj
      changes = {_sort: _sort}
      if (key &amp;&amp; r.get(key) != val) {
        changes[key] = val
      }
      r.set(changes)
    } else {
      obj._sort = _sort
      if (key) {
        obj[key] = val
      }
      r = doc.set(id(obj), obj)
    }
    sort(this._array)
    return r
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.after" id="apidoc.element.crdt.Seq.prototype.after">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.after
        <span class="apidocSignatureSpan">(obj, after)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.after = function (obj, after) {
  return this.insert(obj, after, this.next(after))
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.asArray" id="apidoc.element.crdt.Seq.prototype.asArray">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.asArray
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.asArray = function () {
  return sort(this._array)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.at" id="apidoc.element.crdt.Seq.prototype.at">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.at
        <span class="apidocSignatureSpan">(i)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.at = function (i) {
  if('__proto__' === i) throw new Error('__proto__ invalid index')
  return this._array[i]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.before" id="apidoc.element.crdt.Seq.prototype.before">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.before
        <span class="apidocSignatureSpan">(obj, before)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.before = function (obj, before) {
  return this.insert(obj, this.prev(before), before)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.first" id="apidoc.element.crdt.Seq.prototype.first">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.first
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.first = function () {
  return this._array[0]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.indexOf" id="apidoc.element.crdt.Seq.prototype.indexOf">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.indexOf
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.indexOf = function (obj) {
  return this._array.indexOf('string' == typeof obj ? this.rows[obj] : obj)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.last" id="apidoc.element.crdt.Seq.prototype.last">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.last
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.last = function () {
  return this._array[this._array.length - 1]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.length" id="apidoc.element.crdt.Seq.prototype.length">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.length
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.length = function () {
  return this._array.length
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.next" id="apidoc.element.crdt.Seq.prototype.next">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.next
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.next = function (key) {
  key = toKey(this.get(key) || '!')
  return max(this._array, function (M, m) {
    if(toKey(m) &gt; key)
      return M ? toKey(m) &lt; toKey(M) : true
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.pop" id="apidoc.element.crdt.Seq.prototype.pop">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.pop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.pop = function () {
  return this.remove(this.last())
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.prev" id="apidoc.element.crdt.Seq.prototype.prev">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.prev
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.prev = function (key) {
  key = toKey(this.get(key) || '~')
  //find the greatest item that is less than `key`.
  //since the list is kept in order,
  //a binary search is used.
  //think about that later
  return max(this._array, function (M, m) {
    if(toKey(m) &lt; key)
      return M ? toKey(m) &gt; toKey(M) : true
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.push" id="apidoc.element.crdt.Seq.prototype.push">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.push
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.push = function (obj) {
  return this.insert(obj, this.last(), '~')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.shift" id="apidoc.element.crdt.Seq.prototype.shift">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.shift
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.shift = function () {
  return this.remove(this.first())
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.unshift" id="apidoc.element.crdt.Seq.prototype.unshift">
        function <span class="apidocSignatureSpan">crdt.</span>Seq.prototype.unshift
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Seq.prototype.unshift = function (obj) {
  return this.insert(obj, '!', this.first())
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set" id="apidoc.element.crdt.Set">
        function <span class="apidocSignatureSpan">crdt.</span>Set
        <span class="apidocSignatureSpan">(doc, key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Set(doc, key, value) {
  var array = this._array = []
  var rows = this.rows =  {}
  var set = this
  var filter

  if ('function' === typeof key) {
    filter = this.filter = key
    key = null
  } else {
    //DO NOT CHANGE once you have created the set.
    if(key === '__proto__') throw new Error('__proto__ is illegal key')
    this.key = key
    this.value = value
  }

  function add(row) {
    if (rows[row.id]) {
      return
    }

    array.push(row)
    rows[row.id] = row
    set.emit('add', row)

    function remove (_, changed) {
      if ((key &amp;&amp; row.state[key] === value) ||
          (filter &amp;&amp; filter(row.state))
      ) {
        set.emit('changes', row, changed)
        return
      }
      delete rows[row.id]
      var i = array.indexOf(row)
      if(~i) array.splice(i, 1)
      set.emit('changes', row, changed)
      set.emit('remove', row)
      row.removeListener('changes', remove)
    }

    row.on('changes', remove)

  }

  if (!filter) {
    doc.sets.on(key, function (row, changed) {
      if(changed[key] !== value) return
      add(row)
    })
  } else {
    doc.on('create', function (row) {
      if (filter(row.state)) {
        add(row)
      }
    })
  }


  this.rm = this.remove = function (row) {
    row = this.get(row)
    if(!row) return
    if (key) {
      return row.set(key, null)
    } else {
      throw new Error("Set cannot remove rows with arbitary filters")
    }
  }

  for(var id in doc.rows) {
    var row = doc.get(id)
    if (key &amp;&amp; row.get(key) === value) {
      add(row)
    } else if (filter &amp;&amp; filter(row.state)) {
      add(row)
    }
  }

  this.setMaxListeners(Infinity)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.asArray" id="apidoc.element.crdt.Set.prototype.asArray">
        function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.asArray
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Set.prototype.asArray = function () {
  return this._array
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.forEach" id="apidoc.element.crdt.Set.prototype.forEach">
        function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.forEach
        <span class="apidocSignatureSpan">(iter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Set.prototype.forEach = function (iter) {
  return this._array.forEach(iter)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.get" id="apidoc.element.crdt.Set.prototype.get">
        function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.get
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Set.prototype.get = function (id) {
  if(!arguments.length)
    return this.array
  if(id === '__proto__') throw new Error('__proto__ is invalid id')
  return (
      'string' === typeof id ? this.rows[id]
    : 'number' === typeof id ? this.rows[id]
    : id &amp;&amp; id.id            ? this.rows[id.id]
    :                          null
  )
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.has" id="apidoc.element.crdt.Set.prototype.has">
        function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.has
        <span class="apidocSignatureSpan">(row)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Set.prototype.has = function (row) {
  return this.get(row)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.onEach" id="apidoc.element.crdt.Set.prototype.onEach">
        function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.onEach
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Set.prototype.onEach = function (callback) {
  this.forEach(callback)
  this.on("add", callback)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.toJSON" id="apidoc.element.crdt.Set.prototype.toJSON">
        function <span class="apidocSignatureSpan">crdt.</span>Set.prototype.toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Set.prototype.toJSON = function () {
  return this._array.map(function (e) {
    return e.state
  }).sort(function (a, b) {
    return between.strord(a._sort || a.id, b._sort || b.id)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.createStream" id="apidoc.element.crdt.createStream">
        function <span class="apidocSignatureSpan">crdt.</span>createStream
        <span class="apidocSignatureSpan">(doc, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createStream = function (doc, opts) {
  return doc.createStream(opts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var B = new Doc()
```

then pipe them together

``` js
var as
(as = A.<span class="apidocCodeKeywordSpan">createStream</span>())
  .pipe(B.createStream())
  .pipe(as)
```

We just replicated two documents with in the same process...
this is the idea, but of course, we want to do it on different machines...
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.debug" id="apidoc.element.crdt.debug">
        function <span class="apidocSignatureSpan">crdt.</span>debug
        <span class="apidocSignatureSpan">(id, doc)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">debug = function (id, doc) {
  if(!doc)
    doc = id, id = 'crdt_debugger'
  var parent = findOrCreate(id)

  var style = document.createElement('style')
  style.innerText = css()
  document.head.appendChild(style)

  function update (row) {
    var el = findOrCreate(row)
    el.innerHTML = render(row)
    if(parent !== el.parentNode)
      parent.appendChild(el)
  }
  doc.on('row_update', update)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_" id="apidoc.element.crdt.super_">
        function <span class="apidocSignatureSpan">crdt.</span>super_
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Scuttlebutt(opts) {

  if(!(this instanceof Scuttlebutt)) return new Scuttlebutt(opts)
  var id = 'string' === typeof opts ? opts : opts &amp;&amp; opts.id
  this.sources = {}
  this.setMaxListeners(Number.MAX_VALUE)
  //count how many other instances we are replicating to.
  this._streams = 0
  if(opts &amp;&amp; opts.sign &amp;&amp; opts.verify) {
    this.setId(opts.id || opts.createId())
    this._sign   = opts.sign
    this._verify = opts.verify
  } else {
    this.setId(id || u.createId())
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype._update" id="apidoc.element.crdt.super_.prototype._update">
        function <span class="apidocSignatureSpan">crdt.</span>super_.prototype._update
        <span class="apidocSignatureSpan">(update)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_.prototype._update = function (update) {
  //validated when it comes into the stream
  var ts = update[1]
  var source = update[2]

  //if this message is old for it's source, ignore it. it's out of
  //order. each node must emit it's changes in order!
  //emit an 'old_data' event because i'll want to track how many
  //unnecessary messages are sent.

  var latest = this.sources[source]
  if(latest &amp;&amp; latest &gt;= ts)
    return emit.call(this, 'old_data', update), false

  this.sources[source] = ts

  var self = this
  function didVerification (err, verified) {

    // I'm not sure how what should happen if a async verification
    // errors. if it's an key not found - that is a verification fail,
    // not a error. if it's genunie error, really you should queue and
    // try again? or replay the message later
    // -- this should be done my the security plugin though, not scuttlebutt.

    if(err)
      return emit.call(self, 'error', err)

    if(!verified)
      return emit.call(self, 'unverified_data', update)

    if(self.applyUpdate(update))
      emit.call(self, '_update', update) //write to stream.
  }

  if(source !== this.id) {
    if(this._verify)
      this._verify(update, didVerification)
    else
      didVerification(null, true)
  } else {
    if(this._sign) {
      //could make this async easily enough.
      update[3] = this._sign(update)
    }
    didVerification(null, true)
  }

  return true
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.applyUpdate" id="apidoc.element.crdt.super_.prototype.applyUpdate">
        function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.applyUpdate
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function dutyOfSubclass() {
  throw new Error('method must be implemented by subclass')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.clone" id="apidoc.element.crdt.super_.prototype.clone">
        function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.clone
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_.prototype.clone = function () {
  var A = this
  var B = new (A.constructor)
  B.setId(A.id) //same id. think this will work...

  A._clones = (A._clones || 0) + 1

  var a = A.createStream({wrapper: 'raw'})
  var b = B.createStream({wrapper: 'raw'})

  //all updates must be sync, so make sure pause never happens.
  a.pause = b.pause = function noop(){}

  streamDone(b, function () {
    A._clones--
    emit.call(A, 'unclone', A._clones)
  })

  a.pipe(b).pipe(a)
  //resume both streams, so that the new instance is brought up to date immediately.
  a.resume()
  b.resume()

  return B
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.createReadStream" id="apidoc.element.crdt.super_.prototype.createReadStream">
        function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.createReadStream
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_.prototype.createReadStream = function (opts) {
  opts = opts || {}
  opts.writable = false; opts.readable = true
  return this.createStream(opts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.createStream" id="apidoc.element.crdt.super_.prototype.createStream">
        function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.createStream
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_.prototype.createStream = function (opts) {
  var self = this
  //the sources for the remote end.
  var sources = {}, other
  var syncSent = false, syncRecv = false

  this._streams ++

  opts = opts || {}
  var d = duplex()
  d.name = opts.name
  var outer = serializer(opts &amp;&amp; opts.wrapper)(d)
  outer.inner = d

  d.writable = opts.writable !== false
  d.readable = opts.readable !== false

  syncRecv   = !d.writable
  syncSent   = !d.readable

  var tail = opts.tail !== false //default to tail=true

  function start (data) {
    //when the digest is recieved from the other end,
    //send the history.
    //merge with the current list of sources.
    if (!data || !data.clock) {
        d.emit('error');
        return d._end()
    }

    sources = data.clock

    i.each(self.history(sources), function (data) {d._data(data)})

    //the _update listener must be set after the history is queued.
    //otherwise there is a race between the first client message
    //and the next update (which may come in on another stream)
    //this problem will probably not be encountered until you have
    //thousands of scuttlebutts.

    self.on('_update', onUpdate)

    d._data('SYNC')
    syncSent = true
    //when we have sent all history
    outer.emit('header', data)
    outer.emit('syncSent')
    //when we have recieved all histoyr
    //emit 'synced' when this stream has synced.
    if(syncRecv) outer.emit('sync'), outer.emit('synced')
    if(!tail) d._end()
  }

  d
    .on('_data', function (data) {
      //if it's an array, it's an update.
      if(Array.isArray(data)) {
        //check whether we are accepting writes.
        if(!d.writable)
          return
        if(validate(data))
          return self._update(data)
      }
      //if it's an object, it's a scuttlebut digest.
      else if('object' === typeof data &amp;&amp; data)
        start(data)
      else if('string' === typeof data &amp;&amp; data == 'SYNC') {
        syncRecv = true
        outer.emit('syncRecieved')
        if(syncSent) outer.emit('sync'), outer.emit('synced')
      }
    }).on('_end', function () {
      d._end()
    })
    .on('close', function () {
      self.removeListener('_update', onUpdate)
      self.removeListener('dispose', dispose)
      //emit the number of streams that are remaining...
      //this will be used for memory management...
      self._streams --
      emit.call(self, 'unstream', self._streams)
    })

  if(opts &amp;&amp; opts.tail === false) {
    outer.on('sync', function () {
      process.nextTick(function () {
        d._end()
      })
    })
  }
  function onUpdate (update) { //value, source, ts
    if(!validate(update) || !u.filter(update, sources))
      return

    d._data(update)

    //really, this should happen before emitting.
    var ts = update[1]
    var source = update[2]
    sources[source] = ts
  }

  function dispose () {
    d.end()
  }

  var outgoing = { id : self.id, clock : self.sources }

  if (opts &amp;&amp; opts.meta) outgoing.meta = opts.meta

  if(d.readable) {
    d._data(outgoing)
    if(!d.writable &amp;&amp; !opts.clock)
      start({clock:{}})

  } else if (opts.sendClock) {
    //send my current clock.
    //so the other side knows what to send
    d._data(outgoing)
  }

  self.once('dispose', dispose)

  return outer
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.createWriteStream" id="apidoc.element.crdt.super_.prototype.createWriteStream">
        function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.createWriteStream
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_.prototype.createWriteStream = function (opts) {
  opts = opts || {}
  opts.writable = true; opts.readable = false
  return this.createStream(opts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.dispose" id="apidoc.element.crdt.super_.prototype.dispose">
        function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.dispose
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_.prototype.dispose = function () {
  emit.call(this, 'dispose')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.localUpdate" id="apidoc.element.crdt.super_.prototype.localUpdate">
        function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.localUpdate
        <span class="apidocSignatureSpan">(trx)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_.prototype.localUpdate = function (trx) {
  this._update([trx, timestamp(), this.id])
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.setId" id="apidoc.element.crdt.super_.prototype.setId">
        function <span class="apidocSignatureSpan">crdt.</span>super_.prototype.setId
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_.prototype.setId = function (id) {
  if('__proto__' === id) throw new Error('__proto__ is invalid id')
  if(id == null) throw new Error('null is not invalid id')
  this.id = id
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.timestamp" id="apidoc.element.crdt.super_.timestamp">
        function <span class="apidocSignatureSpan">crdt.</span>super_.timestamp
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function timestamp() {
<span class="apidocCodeCommentSpan">  /**
  Returns NOT an accurate representation of the current time.
  Since js only measures time as ms, if you call `Date.now()`
  twice quickly, it's possible to get two identical time stamps.
  This function guarantees unique but maybe inaccurate results
  on each call.
  **/
</span>  //uncomment this wen
  var time = Date.now()
  //time = ~~ (time / 1000)
  //^^^uncomment when testing...

  /**
  If time returned is same as in last call, adjust it by
  adding a number based on the counter.
  Counter is incremented so that next call get's adjusted properly.
  Because floats have restricted precision,
  may need to step past some values...
  **/
  if (_last === time)  {
    do {
      adjusted = time + ((_count++) / (_count + 999))
    } while (adjusted === _adjusted)
    _adjusted = adjusted
  }
  // If last time was different reset timer back to `1`.
  else {
    _count = 1
    adjusted = time
  }
  _adjusted = adjusted
  _last = time
  return adjusted
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.updateIsRecent" id="apidoc.element.crdt.super_.updateIsRecent">
        function <span class="apidocSignatureSpan">crdt.</span>super_.updateIsRecent
        <span class="apidocSignatureSpan">(update, sources)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">super_.updateIsRecent = function (update, sources) {
  var ts = update[1]
  var source = update[2]
  return (!sources || !sources[source] || sources[source] &lt; ts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.sync" id="apidoc.element.crdt.sync">
        function <span class="apidocSignatureSpan">crdt.</span>sync
        <span class="apidocSignatureSpan">(a, b)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function sync(a, b) {
  var as = a.createStream()
  var bs = b.createStream()
  return as.pipe(bs).pipe(as)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.toString" id="apidoc.element.crdt.toString">
        function <span class="apidocSignatureSpan">crdt.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
    return text;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Row" id="apidoc.module.crdt.Row">module crdt.Row</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Row.Row" id="apidoc.element.crdt.Row.Row">
        function <span class="apidocSignatureSpan">crdt.</span>Row
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Row(id) {
  this.id = id
  this.state = {id: id}
  this.setMaxListeners(Infinity)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.super_" id="apidoc.element.crdt.Row.super_">
        function <span class="apidocSignatureSpan">crdt.Row.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Row.prototype" id="apidoc.module.crdt.Row.prototype">module crdt.Row.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Row.prototype._set" id="apidoc.element.crdt.Row.prototype._set">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>_set
        <span class="apidocSignatureSpan">(changes, source)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_set = function (changes, source) {

  //the change is applied by the Doc!
  this.emit('preupdate', changes, source)
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.get" id="apidoc.element.crdt.Row.prototype.get">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key) {
  if(key)
    return this.state[key]
  return this.state
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.set" id="apidoc.element.crdt.Row.prototype.set">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>set
        <span class="apidocSignatureSpan">(changes, v)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (changes, v) {
  if(arguments.length == 2) {
    var k = changes
    if(k === '__proto__')
      return this
    changes = {}
    changes[k] = v
  }

  if(changes !== null &amp;&amp; changes.id &amp;&amp; changes.id !== this.state.id)
    throw new Error('id cannot be changed')

  this._set(changes, 'local')
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.toJSON" id="apidoc.element.crdt.Row.prototype.toJSON">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function () {
  return this.state
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
display: inline-block; \
}                        ';

}

function render (row) {
var html = ''//'&lt;div class=row id="' row.id + '"&gt;\n'
var o = row.<span class="apidocCodeKeywordSpan">toJSON</span>()
for(var k in o) {
  html += '&lt;div class=pair&gt;'
  html += '  &lt;div class=key id="'+   row.id +':key:'+   k +'"&gt;' + k + '&amp;#
x3c;/div&gt;\n'
  html += '  &lt;div class=value id="'+ row.id +':value:'+ k +'"&gt;' + o[k] + '
;&lt;/div&gt;\n'
  html += '&lt;/div&gt;'
}
return html
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.validate" id="apidoc.element.crdt.Row.prototype.validate">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>validate
        <span class="apidocSignatureSpan">(changes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validate = function (changes) {
  try {
    this.emit('validate', changes)
    return true
  } catch (e) {
    console.error('validation', e.message)
    return false
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Row.prototype._set" id="apidoc.module.crdt.Row.prototype._set">module crdt.Row.prototype._set</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Row.prototype._set._set" id="apidoc.element.crdt.Row.prototype._set._set">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>_set
        <span class="apidocSignatureSpan">(changes, source)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_set = function (changes, source) {

  //the change is applied by the Doc!
  this.emit('preupdate', changes, source)
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Row.prototype.get" id="apidoc.module.crdt.Row.prototype.get">module crdt.Row.prototype.get</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.get.get" id="apidoc.element.crdt.Row.prototype.get.get">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key) {
  if(key)
    return this.state[key]
  return this.state
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Row.prototype.set" id="apidoc.module.crdt.Row.prototype.set">module crdt.Row.prototype.set</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.set.set" id="apidoc.element.crdt.Row.prototype.set.set">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>set
        <span class="apidocSignatureSpan">(changes, v)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (changes, v) {
  if(arguments.length == 2) {
    var k = changes
    if(k === '__proto__')
      return this
    changes = {}
    changes[k] = v
  }

  if(changes !== null &amp;&amp; changes.id &amp;&amp; changes.id !== this.state.id)
    throw new Error('id cannot be changed')

  this._set(changes, 'local')
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Row.prototype.toJSON" id="apidoc.module.crdt.Row.prototype.toJSON">module crdt.Row.prototype.toJSON</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.toJSON.toJSON" id="apidoc.element.crdt.Row.prototype.toJSON.toJSON">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function () {
  return this.state
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
display: inline-block; \
}                        ';

}

function render (row) {
var html = ''//'&lt;div class=row id="' row.id + '"&gt;\n'
var o = row.<span class="apidocCodeKeywordSpan">toJSON</span>()
for(var k in o) {
  html += '&lt;div class=pair&gt;'
  html += '  &lt;div class=key id="'+   row.id +':key:'+   k +'"&gt;' + k + '&amp;#
x3c;/div&gt;\n'
  html += '  &lt;div class=value id="'+ row.id +':value:'+ k +'"&gt;' + o[k] + '
;&lt;/div&gt;\n'
  html += '&lt;/div&gt;'
}
return html
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Row.prototype.validate" id="apidoc.module.crdt.Row.prototype.validate">module crdt.Row.prototype.validate</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Row.prototype.validate.validate" id="apidoc.element.crdt.Row.prototype.validate.validate">
        function <span class="apidocSignatureSpan">crdt.Row.prototype.</span>validate
        <span class="apidocSignatureSpan">(changes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validate = function (changes) {
  try {
    this.emit('validate', changes)
    return true
  } catch (e) {
    console.error('validation', e.message)
    return false
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq" id="apidoc.module.crdt.Seq">module crdt.Seq</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.Seq" id="apidoc.element.crdt.Seq.Seq">
        function <span class="apidocSignatureSpan">crdt.</span>Seq
        <span class="apidocSignatureSpan">(doc, key, val)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Seq(doc, key, val) {
  if(key == '__proto__')
    throw new Error('__proto__ is invalid key')

  Set.call(this, doc, key, val)

  if (typeof key !== 'string') {
    key = null
  }

  var seq = this
  this.on('changes', function (row, changes) {
    if(!changes._sort) return
    sort(seq._array)
    //check if there is already an item with this sort key.
    var prev =
    find(seq._array, function (other) {
      return other != row &amp;&amp; other.get('_sort') == row.get('_sort')
    })

    //nudge it forward if it has the same key.
    if(prev)
      seq.insert(row, prev, seq.next(row))
    else
      seq.emit('move', row)
  })
  this.insert = function (obj, before, after) {

    before = toKey(this.get(before) || '!')
    after  = toKey(this.get(after)  || '~')

    //must get id from the doc,
    //because may be moving this item into this set.
    if('string' === typeof obj)
      obj = doc.rows[obj]

    var _sort =
       between.between(before, after )
     + between.randstr(3) //add a random tail so it's hard
                    //to concurrently add two items with the
                    //same sort.

    var r, changes
    if(obj instanceof Row) {
      r = obj
      changes = {_sort: _sort}
      if (key &amp;&amp; r.get(key) != val) {
        changes[key] = val
      }
      r.set(changes)
    } else {
      obj._sort = _sort
      if (key) {
        obj[key] = val
      }
      r = doc.set(id(obj), obj)
    }
    sort(this._array)
    return r
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.super_" id="apidoc.element.crdt.Seq.super_">
        function <span class="apidocSignatureSpan">crdt.Seq.</span>super_
        <span class="apidocSignatureSpan">(doc, key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Set(doc, key, value) {
  var array = this._array = []
  var rows = this.rows =  {}
  var set = this
  var filter

  if ('function' === typeof key) {
    filter = this.filter = key
    key = null
  } else {
    //DO NOT CHANGE once you have created the set.
    if(key === '__proto__') throw new Error('__proto__ is illegal key')
    this.key = key
    this.value = value
  }

  function add(row) {
    if (rows[row.id]) {
      return
    }

    array.push(row)
    rows[row.id] = row
    set.emit('add', row)

    function remove (_, changed) {
      if ((key &amp;&amp; row.state[key] === value) ||
          (filter &amp;&amp; filter(row.state))
      ) {
        set.emit('changes', row, changed)
        return
      }
      delete rows[row.id]
      var i = array.indexOf(row)
      if(~i) array.splice(i, 1)
      set.emit('changes', row, changed)
      set.emit('remove', row)
      row.removeListener('changes', remove)
    }

    row.on('changes', remove)

  }

  if (!filter) {
    doc.sets.on(key, function (row, changed) {
      if(changed[key] !== value) return
      add(row)
    })
  } else {
    doc.on('create', function (row) {
      if (filter(row.state)) {
        add(row)
      }
    })
  }


  this.rm = this.remove = function (row) {
    row = this.get(row)
    if(!row) return
    if (key) {
      return row.set(key, null)
    } else {
      throw new Error("Set cannot remove rows with arbitary filters")
    }
  }

  for(var id in doc.rows) {
    var row = doc.get(id)
    if (key &amp;&amp; row.get(key) === value) {
      add(row)
    } else if (filter &amp;&amp; filter(row.state)) {
      add(row)
    }
  }

  this.setMaxListeners(Infinity)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype" id="apidoc.module.crdt.Seq.prototype">module crdt.Seq.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.after" id="apidoc.element.crdt.Seq.prototype.after">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>after
        <span class="apidocSignatureSpan">(obj, after)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">after = function (obj, after) {
  return this.insert(obj, after, this.next(after))
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.asArray" id="apidoc.element.crdt.Seq.prototype.asArray">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>asArray
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">asArray = function () {
  return sort(this._array)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.at" id="apidoc.element.crdt.Seq.prototype.at">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>at
        <span class="apidocSignatureSpan">(i)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">at = function (i) {
  if('__proto__' === i) throw new Error('__proto__ invalid index')
  return this._array[i]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.before" id="apidoc.element.crdt.Seq.prototype.before">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>before
        <span class="apidocSignatureSpan">(obj, before)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">before = function (obj, before) {
  return this.insert(obj, this.prev(before), before)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.first" id="apidoc.element.crdt.Seq.prototype.first">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>first
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">first = function () {
  return this._array[0]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.indexOf" id="apidoc.element.crdt.Seq.prototype.indexOf">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>indexOf
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">indexOf = function (obj) {
  return this._array.indexOf('string' == typeof obj ? this.rows[obj] : obj)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.last" id="apidoc.element.crdt.Seq.prototype.last">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>last
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">last = function () {
  return this._array[this._array.length - 1]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.length" id="apidoc.element.crdt.Seq.prototype.length">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>length
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">length = function () {
  return this._array.length
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.next" id="apidoc.element.crdt.Seq.prototype.next">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>next
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">next = function (key) {
  key = toKey(this.get(key) || '!')
  return max(this._array, function (M, m) {
    if(toKey(m) &gt; key)
      return M ? toKey(m) &lt; toKey(M) : true
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.pop" id="apidoc.element.crdt.Seq.prototype.pop">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>pop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pop = function () {
  return this.remove(this.last())
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.prev" id="apidoc.element.crdt.Seq.prototype.prev">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>prev
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">prev = function (key) {
  key = toKey(this.get(key) || '~')
  //find the greatest item that is less than `key`.
  //since the list is kept in order,
  //a binary search is used.
  //think about that later
  return max(this._array, function (M, m) {
    if(toKey(m) &lt; key)
      return M ? toKey(m) &gt; toKey(M) : true
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.push" id="apidoc.element.crdt.Seq.prototype.push">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>push
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">push = function (obj) {
  return this.insert(obj, this.last(), '~')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.shift" id="apidoc.element.crdt.Seq.prototype.shift">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>shift
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">shift = function () {
  return this.remove(this.first())
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.unshift" id="apidoc.element.crdt.Seq.prototype.unshift">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>unshift
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unshift = function (obj) {
  return this.insert(obj, '!', this.first())
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.after" id="apidoc.module.crdt.Seq.prototype.after">module crdt.Seq.prototype.after</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.after.after" id="apidoc.element.crdt.Seq.prototype.after.after">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>after
        <span class="apidocSignatureSpan">(obj, after)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">after = function (obj, after) {
  return this.insert(obj, after, this.next(after))
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.asArray" id="apidoc.module.crdt.Seq.prototype.asArray">module crdt.Seq.prototype.asArray</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.asArray.asArray" id="apidoc.element.crdt.Seq.prototype.asArray.asArray">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>asArray
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">asArray = function () {
  return sort(this._array)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.at" id="apidoc.module.crdt.Seq.prototype.at">module crdt.Seq.prototype.at</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.at.at" id="apidoc.element.crdt.Seq.prototype.at.at">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>at
        <span class="apidocSignatureSpan">(i)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">at = function (i) {
  if('__proto__' === i) throw new Error('__proto__ invalid index')
  return this._array[i]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.before" id="apidoc.module.crdt.Seq.prototype.before">module crdt.Seq.prototype.before</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.before.before" id="apidoc.element.crdt.Seq.prototype.before.before">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>before
        <span class="apidocSignatureSpan">(obj, before)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">before = function (obj, before) {
  return this.insert(obj, this.prev(before), before)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.first" id="apidoc.module.crdt.Seq.prototype.first">module crdt.Seq.prototype.first</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.first.first" id="apidoc.element.crdt.Seq.prototype.first.first">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>first
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">first = function () {
  return this._array[0]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.indexOf" id="apidoc.module.crdt.Seq.prototype.indexOf">module crdt.Seq.prototype.indexOf</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.indexOf.indexOf" id="apidoc.element.crdt.Seq.prototype.indexOf.indexOf">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>indexOf
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">indexOf = function (obj) {
  return this._array.indexOf('string' == typeof obj ? this.rows[obj] : obj)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.last" id="apidoc.module.crdt.Seq.prototype.last">module crdt.Seq.prototype.last</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.last.last" id="apidoc.element.crdt.Seq.prototype.last.last">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>last
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">last = function () {
  return this._array[this._array.length - 1]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.length" id="apidoc.module.crdt.Seq.prototype.length">module crdt.Seq.prototype.length</a></h1>

</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.next" id="apidoc.module.crdt.Seq.prototype.next">module crdt.Seq.prototype.next</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.next.next" id="apidoc.element.crdt.Seq.prototype.next.next">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>next
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">next = function (key) {
  key = toKey(this.get(key) || '!')
  return max(this._array, function (M, m) {
    if(toKey(m) &gt; key)
      return M ? toKey(m) &lt; toKey(M) : true
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.pop" id="apidoc.module.crdt.Seq.prototype.pop">module crdt.Seq.prototype.pop</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.pop.pop" id="apidoc.element.crdt.Seq.prototype.pop.pop">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>pop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pop = function () {
  return this.remove(this.last())
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.prev" id="apidoc.module.crdt.Seq.prototype.prev">module crdt.Seq.prototype.prev</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.prev.prev" id="apidoc.element.crdt.Seq.prototype.prev.prev">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>prev
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">prev = function (key) {
  key = toKey(this.get(key) || '~')
  //find the greatest item that is less than `key`.
  //since the list is kept in order,
  //a binary search is used.
  //think about that later
  return max(this._array, function (M, m) {
    if(toKey(m) &lt; key)
      return M ? toKey(m) &gt; toKey(M) : true
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.push" id="apidoc.module.crdt.Seq.prototype.push">module crdt.Seq.prototype.push</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.push.push" id="apidoc.element.crdt.Seq.prototype.push.push">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>push
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">push = function (obj) {
  return this.insert(obj, this.last(), '~')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.shift" id="apidoc.module.crdt.Seq.prototype.shift">module crdt.Seq.prototype.shift</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.shift.shift" id="apidoc.element.crdt.Seq.prototype.shift.shift">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>shift
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">shift = function () {
  return this.remove(this.first())
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Seq.prototype.unshift" id="apidoc.module.crdt.Seq.prototype.unshift">module crdt.Seq.prototype.unshift</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Seq.prototype.unshift.unshift" id="apidoc.element.crdt.Seq.prototype.unshift.unshift">
        function <span class="apidocSignatureSpan">crdt.Seq.prototype.</span>unshift
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unshift = function (obj) {
  return this.insert(obj, '!', this.first())
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Set" id="apidoc.module.crdt.Set">module crdt.Set</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Set.Set" id="apidoc.element.crdt.Set.Set">
        function <span class="apidocSignatureSpan">crdt.</span>Set
        <span class="apidocSignatureSpan">(doc, key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Set(doc, key, value) {
  var array = this._array = []
  var rows = this.rows =  {}
  var set = this
  var filter

  if ('function' === typeof key) {
    filter = this.filter = key
    key = null
  } else {
    //DO NOT CHANGE once you have created the set.
    if(key === '__proto__') throw new Error('__proto__ is illegal key')
    this.key = key
    this.value = value
  }

  function add(row) {
    if (rows[row.id]) {
      return
    }

    array.push(row)
    rows[row.id] = row
    set.emit('add', row)

    function remove (_, changed) {
      if ((key &amp;&amp; row.state[key] === value) ||
          (filter &amp;&amp; filter(row.state))
      ) {
        set.emit('changes', row, changed)
        return
      }
      delete rows[row.id]
      var i = array.indexOf(row)
      if(~i) array.splice(i, 1)
      set.emit('changes', row, changed)
      set.emit('remove', row)
      row.removeListener('changes', remove)
    }

    row.on('changes', remove)

  }

  if (!filter) {
    doc.sets.on(key, function (row, changed) {
      if(changed[key] !== value) return
      add(row)
    })
  } else {
    doc.on('create', function (row) {
      if (filter(row.state)) {
        add(row)
      }
    })
  }


  this.rm = this.remove = function (row) {
    row = this.get(row)
    if(!row) return
    if (key) {
      return row.set(key, null)
    } else {
      throw new Error("Set cannot remove rows with arbitary filters")
    }
  }

  for(var id in doc.rows) {
    var row = doc.get(id)
    if (key &amp;&amp; row.get(key) === value) {
      add(row)
    } else if (filter &amp;&amp; filter(row.state)) {
      add(row)
    }
  }

  this.setMaxListeners(Infinity)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.super_" id="apidoc.element.crdt.Set.super_">
        function <span class="apidocSignatureSpan">crdt.Set.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Set.prototype" id="apidoc.module.crdt.Set.prototype">module crdt.Set.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.asArray" id="apidoc.element.crdt.Set.prototype.asArray">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>asArray
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">asArray = function () {
  return this._array
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.each" id="apidoc.element.crdt.Set.prototype.each">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>each
        <span class="apidocSignatureSpan">(iter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">each = function (iter) {
  return this._array.forEach(iter)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.forEach" id="apidoc.element.crdt.Set.prototype.forEach">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>forEach
        <span class="apidocSignatureSpan">(iter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">forEach = function (iter) {
  return this._array.forEach(iter)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.get" id="apidoc.element.crdt.Set.prototype.get">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>get
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (id) {
  if(!arguments.length)
    return this.array
  if(id === '__proto__') throw new Error('__proto__ is invalid id')
  return (
      'string' === typeof id ? this.rows[id]
    : 'number' === typeof id ? this.rows[id]
    : id &amp;&amp; id.id            ? this.rows[id.id]
    :                          null
  )
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.has" id="apidoc.element.crdt.Set.prototype.has">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>has
        <span class="apidocSignatureSpan">(row)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">has = function (row) {
  return this.get(row)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.onEach" id="apidoc.element.crdt.Set.prototype.onEach">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>onEach
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onEach = function (callback) {
  this.forEach(callback)
  this.on("add", callback)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.toJSON" id="apidoc.element.crdt.Set.prototype.toJSON">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function () {
  return this._array.map(function (e) {
    return e.state
  }).sort(function (a, b) {
    return between.strord(a._sort || a.id, b._sort || b.id)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
display: inline-block; \
}                        ';

}

function render (row) {
var html = ''//'&lt;div class=row id="' row.id + '"&gt;\n'
var o = row.<span class="apidocCodeKeywordSpan">toJSON</span>()
for(var k in o) {
  html += '&lt;div class=pair&gt;'
  html += '  &lt;div class=key id="'+   row.id +':key:'+   k +'"&gt;' + k + '&amp;#
x3c;/div&gt;\n'
  html += '  &lt;div class=value id="'+ row.id +':value:'+ k +'"&gt;' + o[k] + '
;&lt;/div&gt;\n'
  html += '&lt;/div&gt;'
}
return html
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Set.prototype.asArray" id="apidoc.module.crdt.Set.prototype.asArray">module crdt.Set.prototype.asArray</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.asArray.asArray" id="apidoc.element.crdt.Set.prototype.asArray.asArray">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>asArray
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">asArray = function () {
  return this._array
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Set.prototype.forEach" id="apidoc.module.crdt.Set.prototype.forEach">module crdt.Set.prototype.forEach</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.forEach.forEach" id="apidoc.element.crdt.Set.prototype.forEach.forEach">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>forEach
        <span class="apidocSignatureSpan">(iter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">forEach = function (iter) {
  return this._array.forEach(iter)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Set.prototype.get" id="apidoc.module.crdt.Set.prototype.get">module crdt.Set.prototype.get</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.get.get" id="apidoc.element.crdt.Set.prototype.get.get">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>get
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (id) {
  if(!arguments.length)
    return this.array
  if(id === '__proto__') throw new Error('__proto__ is invalid id')
  return (
      'string' === typeof id ? this.rows[id]
    : 'number' === typeof id ? this.rows[id]
    : id &amp;&amp; id.id            ? this.rows[id.id]
    :                          null
  )
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Set.prototype.has" id="apidoc.module.crdt.Set.prototype.has">module crdt.Set.prototype.has</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.has.has" id="apidoc.element.crdt.Set.prototype.has.has">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>has
        <span class="apidocSignatureSpan">(row)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">has = function (row) {
  return this.get(row)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Set.prototype.onEach" id="apidoc.module.crdt.Set.prototype.onEach">module crdt.Set.prototype.onEach</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.onEach.onEach" id="apidoc.element.crdt.Set.prototype.onEach.onEach">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>onEach
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onEach = function (callback) {
  this.forEach(callback)
  this.on("add", callback)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.Set.prototype.toJSON" id="apidoc.module.crdt.Set.prototype.toJSON">module crdt.Set.prototype.toJSON</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.Set.prototype.toJSON.toJSON" id="apidoc.element.crdt.Set.prototype.toJSON.toJSON">
        function <span class="apidocSignatureSpan">crdt.Set.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function () {
  return this._array.map(function (e) {
    return e.state
  }).sort(function (a, b) {
    return between.strord(a._sort || a.id, b._sort || b.id)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
display: inline-block; \
}                        ';

}

function render (row) {
var html = ''//'&lt;div class=row id="' row.id + '"&gt;\n'
var o = row.<span class="apidocCodeKeywordSpan">toJSON</span>()
for(var k in o) {
  html += '&lt;div class=pair&gt;'
  html += '  &lt;div class=key id="'+   row.id +':key:'+   k +'"&gt;' + k + '&amp;#
x3c;/div&gt;\n'
  html += '  &lt;div class=value id="'+ row.id +':value:'+ k +'"&gt;' + o[k] + '
;&lt;/div&gt;\n'
  html += '&lt;/div&gt;'
}
return html
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.createStream" id="apidoc.module.crdt.createStream">module crdt.createStream</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.createStream.createStream" id="apidoc.element.crdt.createStream.createStream">
        function <span class="apidocSignatureSpan">crdt.</span>createStream
        <span class="apidocSignatureSpan">(doc, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createStream = function (doc, opts) {
  return doc.createStream(opts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var B = new Doc()
```

then pipe them together

``` js
var as
(as = A.<span class="apidocCodeKeywordSpan">createStream</span>())
  .pipe(B.createStream())
  .pipe(as)
```

We just replicated two documents with in the same process...
this is the idea, but of course, we want to do it on different machines...
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.debug" id="apidoc.module.crdt.debug">module crdt.debug</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.debug.debug" id="apidoc.element.crdt.debug.debug">
        function <span class="apidocSignatureSpan">crdt.</span>debug
        <span class="apidocSignatureSpan">(id, doc)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">debug = function (id, doc) {
  if(!doc)
    doc = id, id = 'crdt_debugger'
  var parent = findOrCreate(id)

  var style = document.createElement('style')
  style.innerText = css()
  document.head.appendChild(style)

  function update (row) {
    var el = findOrCreate(row)
    el.innerHTML = render(row)
    if(parent !== el.parentNode)
      parent.appendChild(el)
  }
  doc.on('row_update', update)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_" id="apidoc.module.crdt.super_">module crdt.super_</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.super_" id="apidoc.element.crdt.super_.super_">
        function <span class="apidocSignatureSpan">crdt.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.filter" id="apidoc.element.crdt.super_.filter">
        function <span class="apidocSignatureSpan">crdt.super_.</span>filter
        <span class="apidocSignatureSpan">(update, sources)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">filter = function (update, sources) {
  var ts = update[1]
  var source = update[2]
  return (!sources || !sources[source] || sources[source] &lt; ts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.timestamp" id="apidoc.element.crdt.super_.timestamp">
        function <span class="apidocSignatureSpan">crdt.super_.</span>timestamp
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function timestamp() {
<span class="apidocCodeCommentSpan">  /**
  Returns NOT an accurate representation of the current time.
  Since js only measures time as ms, if you call `Date.now()`
  twice quickly, it's possible to get two identical time stamps.
  This function guarantees unique but maybe inaccurate results
  on each call.
  **/
</span>  //uncomment this wen
  var time = Date.now()
  //time = ~~ (time / 1000)
  //^^^uncomment when testing...

  /**
  If time returned is same as in last call, adjust it by
  adding a number based on the counter.
  Counter is incremented so that next call get's adjusted properly.
  Because floats have restricted precision,
  may need to step past some values...
  **/
  if (_last === time)  {
    do {
      adjusted = time + ((_count++) / (_count + 999))
    } while (adjusted === _adjusted)
    _adjusted = adjusted
  }
  // If last time was different reset timer back to `1`.
  else {
    _count = 1
    adjusted = time
  }
  _adjusted = adjusted
  _last = time
  return adjusted
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.updateIsRecent" id="apidoc.element.crdt.super_.updateIsRecent">
        function <span class="apidocSignatureSpan">crdt.super_.</span>updateIsRecent
        <span class="apidocSignatureSpan">(update, sources)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">updateIsRecent = function (update, sources) {
  var ts = update[1]
  var source = update[2]
  return (!sources || !sources[source] || sources[source] &lt; ts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype" id="apidoc.module.crdt.super_.prototype">module crdt.super_.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype._update" id="apidoc.element.crdt.super_.prototype._update">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>_update
        <span class="apidocSignatureSpan">(update)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_update = function (update) {
  //validated when it comes into the stream
  var ts = update[1]
  var source = update[2]

  //if this message is old for it's source, ignore it. it's out of
  //order. each node must emit it's changes in order!
  //emit an 'old_data' event because i'll want to track how many
  //unnecessary messages are sent.

  var latest = this.sources[source]
  if(latest &amp;&amp; latest &gt;= ts)
    return emit.call(this, 'old_data', update), false

  this.sources[source] = ts

  var self = this
  function didVerification (err, verified) {

    // I'm not sure how what should happen if a async verification
    // errors. if it's an key not found - that is a verification fail,
    // not a error. if it's genunie error, really you should queue and
    // try again? or replay the message later
    // -- this should be done my the security plugin though, not scuttlebutt.

    if(err)
      return emit.call(self, 'error', err)

    if(!verified)
      return emit.call(self, 'unverified_data', update)

    if(self.applyUpdate(update))
      emit.call(self, '_update', update) //write to stream.
  }

  if(source !== this.id) {
    if(this._verify)
      this._verify(update, didVerification)
    else
      didVerification(null, true)
  } else {
    if(this._sign) {
      //could make this async easily enough.
      update[3] = this._sign(update)
    }
    didVerification(null, true)
  }

  return true
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.applyUpdate" id="apidoc.element.crdt.super_.prototype.applyUpdate">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>applyUpdate
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function dutyOfSubclass() {
  throw new Error('method must be implemented by subclass')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.clone" id="apidoc.element.crdt.super_.prototype.clone">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>clone
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clone = function () {
  var A = this
  var B = new (A.constructor)
  B.setId(A.id) //same id. think this will work...

  A._clones = (A._clones || 0) + 1

  var a = A.createStream({wrapper: 'raw'})
  var b = B.createStream({wrapper: 'raw'})

  //all updates must be sync, so make sure pause never happens.
  a.pause = b.pause = function noop(){}

  streamDone(b, function () {
    A._clones--
    emit.call(A, 'unclone', A._clones)
  })

  a.pipe(b).pipe(a)
  //resume both streams, so that the new instance is brought up to date immediately.
  a.resume()
  b.resume()

  return B
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.createReadStream" id="apidoc.element.crdt.super_.prototype.createReadStream">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createReadStream
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createReadStream = function (opts) {
  opts = opts || {}
  opts.writable = false; opts.readable = true
  return this.createStream(opts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.createStream" id="apidoc.element.crdt.super_.prototype.createStream">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createStream
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createStream = function (opts) {
  var self = this
  //the sources for the remote end.
  var sources = {}, other
  var syncSent = false, syncRecv = false

  this._streams ++

  opts = opts || {}
  var d = duplex()
  d.name = opts.name
  var outer = serializer(opts &amp;&amp; opts.wrapper)(d)
  outer.inner = d

  d.writable = opts.writable !== false
  d.readable = opts.readable !== false

  syncRecv   = !d.writable
  syncSent   = !d.readable

  var tail = opts.tail !== false //default to tail=true

  function start (data) {
    //when the digest is recieved from the other end,
    //send the history.
    //merge with the current list of sources.
    if (!data || !data.clock) {
        d.emit('error');
        return d._end()
    }

    sources = data.clock

    i.each(self.history(sources), function (data) {d._data(data)})

    //the _update listener must be set after the history is queued.
    //otherwise there is a race between the first client message
    //and the next update (which may come in on another stream)
    //this problem will probably not be encountered until you have
    //thousands of scuttlebutts.

    self.on('_update', onUpdate)

    d._data('SYNC')
    syncSent = true
    //when we have sent all history
    outer.emit('header', data)
    outer.emit('syncSent')
    //when we have recieved all histoyr
    //emit 'synced' when this stream has synced.
    if(syncRecv) outer.emit('sync'), outer.emit('synced')
    if(!tail) d._end()
  }

  d
    .on('_data', function (data) {
      //if it's an array, it's an update.
      if(Array.isArray(data)) {
        //check whether we are accepting writes.
        if(!d.writable)
          return
        if(validate(data))
          return self._update(data)
      }
      //if it's an object, it's a scuttlebut digest.
      else if('object' === typeof data &amp;&amp; data)
        start(data)
      else if('string' === typeof data &amp;&amp; data == 'SYNC') {
        syncRecv = true
        outer.emit('syncRecieved')
        if(syncSent) outer.emit('sync'), outer.emit('synced')
      }
    }).on('_end', function () {
      d._end()
    })
    .on('close', function () {
      self.removeListener('_update', onUpdate)
      self.removeListener('dispose', dispose)
      //emit the number of streams that are remaining...
      //this will be used for memory management...
      self._streams --
      emit.call(self, 'unstream', self._streams)
    })

  if(opts &amp;&amp; opts.tail === false) {
    outer.on('sync', function () {
      process.nextTick(function () {
        d._end()
      })
    })
  }
  function onUpdate (update) { //value, source, ts
    if(!validate(update) || !u.filter(update, sources))
      return

    d._data(update)

    //really, this should happen before emitting.
    var ts = update[1]
    var source = update[2]
    sources[source] = ts
  }

  function dispose () {
    d.end()
  }

  var outgoing = { id : self.id, clock : self.sources }

  if (opts &amp;&amp; opts.meta) outgoing.meta = opts.meta

  if(d.readable) {
    d._data(outgoing)
    if(!d.writable &amp;&amp; !opts.clock)
      start({clock:{}})

  } else if (opts.sendClock) {
    //send my current clock.
    //so the other side knows what to send
    d._data(outgoing)
  }

  self.once('dispose', dispose)

  return outer
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var B = new Doc()
```

then pipe them together

``` js
var as
(as = A.<span class="apidocCodeKeywordSpan">createStream</span>())
  .pipe(B.createStream())
  .pipe(as)
```

We just replicated two documents with in the same process...
this is the idea, but of course, we want to do it on different machines...
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.createWriteStream" id="apidoc.element.crdt.super_.prototype.createWriteStream">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createWriteStream
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createWriteStream = function (opts) {
  opts = opts || {}
  opts.writable = true; opts.readable = false
  return this.createStream(opts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.dispose" id="apidoc.element.crdt.super_.prototype.dispose">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>dispose
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">dispose = function () {
  emit.call(this, 'dispose')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.history" id="apidoc.element.crdt.super_.prototype.history">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>history
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function dutyOfSubclass() {
  throw new Error('method must be implemented by subclass')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.localUpdate" id="apidoc.element.crdt.super_.prototype.localUpdate">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>localUpdate
        <span class="apidocSignatureSpan">(trx)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">localUpdate = function (trx) {
  this._update([trx, timestamp(), this.id])
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.setId" id="apidoc.element.crdt.super_.prototype.setId">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>setId
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setId = function (id) {
  if('__proto__' === id) throw new Error('__proto__ is invalid id')
  if(id == null) throw new Error('null is not invalid id')
  this.id = id
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype._update" id="apidoc.module.crdt.super_.prototype._update">module crdt.super_.prototype._update</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype._update._update" id="apidoc.element.crdt.super_.prototype._update._update">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>_update
        <span class="apidocSignatureSpan">(update)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_update = function (update) {
  //validated when it comes into the stream
  var ts = update[1]
  var source = update[2]

  //if this message is old for it's source, ignore it. it's out of
  //order. each node must emit it's changes in order!
  //emit an 'old_data' event because i'll want to track how many
  //unnecessary messages are sent.

  var latest = this.sources[source]
  if(latest &amp;&amp; latest &gt;= ts)
    return emit.call(this, 'old_data', update), false

  this.sources[source] = ts

  var self = this
  function didVerification (err, verified) {

    // I'm not sure how what should happen if a async verification
    // errors. if it's an key not found - that is a verification fail,
    // not a error. if it's genunie error, really you should queue and
    // try again? or replay the message later
    // -- this should be done my the security plugin though, not scuttlebutt.

    if(err)
      return emit.call(self, 'error', err)

    if(!verified)
      return emit.call(self, 'unverified_data', update)

    if(self.applyUpdate(update))
      emit.call(self, '_update', update) //write to stream.
  }

  if(source !== this.id) {
    if(this._verify)
      this._verify(update, didVerification)
    else
      didVerification(null, true)
  } else {
    if(this._sign) {
      //could make this async easily enough.
      update[3] = this._sign(update)
    }
    didVerification(null, true)
  }

  return true
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype.applyUpdate" id="apidoc.module.crdt.super_.prototype.applyUpdate">module crdt.super_.prototype.applyUpdate</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.applyUpdate.applyUpdate" id="apidoc.element.crdt.super_.prototype.applyUpdate.applyUpdate">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>applyUpdate
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function dutyOfSubclass() {
  throw new Error('method must be implemented by subclass')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype.clone" id="apidoc.module.crdt.super_.prototype.clone">module crdt.super_.prototype.clone</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.clone.clone" id="apidoc.element.crdt.super_.prototype.clone.clone">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>clone
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clone = function () {
  var A = this
  var B = new (A.constructor)
  B.setId(A.id) //same id. think this will work...

  A._clones = (A._clones || 0) + 1

  var a = A.createStream({wrapper: 'raw'})
  var b = B.createStream({wrapper: 'raw'})

  //all updates must be sync, so make sure pause never happens.
  a.pause = b.pause = function noop(){}

  streamDone(b, function () {
    A._clones--
    emit.call(A, 'unclone', A._clones)
  })

  a.pipe(b).pipe(a)
  //resume both streams, so that the new instance is brought up to date immediately.
  a.resume()
  b.resume()

  return B
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype.createReadStream" id="apidoc.module.crdt.super_.prototype.createReadStream">module crdt.super_.prototype.createReadStream</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.createReadStream.createReadStream" id="apidoc.element.crdt.super_.prototype.createReadStream.createReadStream">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createReadStream
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createReadStream = function (opts) {
  opts = opts || {}
  opts.writable = false; opts.readable = true
  return this.createStream(opts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype.createStream" id="apidoc.module.crdt.super_.prototype.createStream">module crdt.super_.prototype.createStream</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.createStream.createStream" id="apidoc.element.crdt.super_.prototype.createStream.createStream">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createStream
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createStream = function (opts) {
  var self = this
  //the sources for the remote end.
  var sources = {}, other
  var syncSent = false, syncRecv = false

  this._streams ++

  opts = opts || {}
  var d = duplex()
  d.name = opts.name
  var outer = serializer(opts &amp;&amp; opts.wrapper)(d)
  outer.inner = d

  d.writable = opts.writable !== false
  d.readable = opts.readable !== false

  syncRecv   = !d.writable
  syncSent   = !d.readable

  var tail = opts.tail !== false //default to tail=true

  function start (data) {
    //when the digest is recieved from the other end,
    //send the history.
    //merge with the current list of sources.
    if (!data || !data.clock) {
        d.emit('error');
        return d._end()
    }

    sources = data.clock

    i.each(self.history(sources), function (data) {d._data(data)})

    //the _update listener must be set after the history is queued.
    //otherwise there is a race between the first client message
    //and the next update (which may come in on another stream)
    //this problem will probably not be encountered until you have
    //thousands of scuttlebutts.

    self.on('_update', onUpdate)

    d._data('SYNC')
    syncSent = true
    //when we have sent all history
    outer.emit('header', data)
    outer.emit('syncSent')
    //when we have recieved all histoyr
    //emit 'synced' when this stream has synced.
    if(syncRecv) outer.emit('sync'), outer.emit('synced')
    if(!tail) d._end()
  }

  d
    .on('_data', function (data) {
      //if it's an array, it's an update.
      if(Array.isArray(data)) {
        //check whether we are accepting writes.
        if(!d.writable)
          return
        if(validate(data))
          return self._update(data)
      }
      //if it's an object, it's a scuttlebut digest.
      else if('object' === typeof data &amp;&amp; data)
        start(data)
      else if('string' === typeof data &amp;&amp; data == 'SYNC') {
        syncRecv = true
        outer.emit('syncRecieved')
        if(syncSent) outer.emit('sync'), outer.emit('synced')
      }
    }).on('_end', function () {
      d._end()
    })
    .on('close', function () {
      self.removeListener('_update', onUpdate)
      self.removeListener('dispose', dispose)
      //emit the number of streams that are remaining...
      //this will be used for memory management...
      self._streams --
      emit.call(self, 'unstream', self._streams)
    })

  if(opts &amp;&amp; opts.tail === false) {
    outer.on('sync', function () {
      process.nextTick(function () {
        d._end()
      })
    })
  }
  function onUpdate (update) { //value, source, ts
    if(!validate(update) || !u.filter(update, sources))
      return

    d._data(update)

    //really, this should happen before emitting.
    var ts = update[1]
    var source = update[2]
    sources[source] = ts
  }

  function dispose () {
    d.end()
  }

  var outgoing = { id : self.id, clock : self.sources }

  if (opts &amp;&amp; opts.meta) outgoing.meta = opts.meta

  if(d.readable) {
    d._data(outgoing)
    if(!d.writable &amp;&amp; !opts.clock)
      start({clock:{}})

  } else if (opts.sendClock) {
    //send my current clock.
    //so the other side knows what to send
    d._data(outgoing)
  }

  self.once('dispose', dispose)

  return outer
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var B = new Doc()
```

then pipe them together

``` js
var as
(as = A.<span class="apidocCodeKeywordSpan">createStream</span>())
  .pipe(B.createStream())
  .pipe(as)
```

We just replicated two documents with in the same process...
this is the idea, but of course, we want to do it on different machines...
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype.createWriteStream" id="apidoc.module.crdt.super_.prototype.createWriteStream">module crdt.super_.prototype.createWriteStream</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.createWriteStream.createWriteStream" id="apidoc.element.crdt.super_.prototype.createWriteStream.createWriteStream">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>createWriteStream
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createWriteStream = function (opts) {
  opts = opts || {}
  opts.writable = true; opts.readable = false
  return this.createStream(opts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype.dispose" id="apidoc.module.crdt.super_.prototype.dispose">module crdt.super_.prototype.dispose</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.dispose.dispose" id="apidoc.element.crdt.super_.prototype.dispose.dispose">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>dispose
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">dispose = function () {
  emit.call(this, 'dispose')
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype.localUpdate" id="apidoc.module.crdt.super_.prototype.localUpdate">module crdt.super_.prototype.localUpdate</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.localUpdate.localUpdate" id="apidoc.element.crdt.super_.prototype.localUpdate.localUpdate">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>localUpdate
        <span class="apidocSignatureSpan">(trx)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">localUpdate = function (trx) {
  this._update([trx, timestamp(), this.id])
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.prototype.setId" id="apidoc.module.crdt.super_.prototype.setId">module crdt.super_.prototype.setId</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.prototype.setId.setId" id="apidoc.element.crdt.super_.prototype.setId.setId">
        function <span class="apidocSignatureSpan">crdt.super_.prototype.</span>setId
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setId = function (id) {
  if('__proto__' === id) throw new Error('__proto__ is invalid id')
  if(id == null) throw new Error('null is not invalid id')
  this.id = id
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.timestamp" id="apidoc.module.crdt.super_.timestamp">module crdt.super_.timestamp</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.timestamp.timestamp" id="apidoc.element.crdt.super_.timestamp.timestamp">
        function <span class="apidocSignatureSpan">crdt.super_.</span>timestamp
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function timestamp() {
<span class="apidocCodeCommentSpan">  /**
  Returns NOT an accurate representation of the current time.
  Since js only measures time as ms, if you call `Date.now()`
  twice quickly, it's possible to get two identical time stamps.
  This function guarantees unique but maybe inaccurate results
  on each call.
  **/
</span>  //uncomment this wen
  var time = Date.now()
  //time = ~~ (time / 1000)
  //^^^uncomment when testing...

  /**
  If time returned is same as in last call, adjust it by
  adding a number based on the counter.
  Counter is incremented so that next call get's adjusted properly.
  Because floats have restricted precision,
  may need to step past some values...
  **/
  if (_last === time)  {
    do {
      adjusted = time + ((_count++) / (_count + 999))
    } while (adjusted === _adjusted)
    _adjusted = adjusted
  }
  // If last time was different reset timer back to `1`.
  else {
    _count = 1
    adjusted = time
  }
  _adjusted = adjusted
  _last = time
  return adjusted
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.super_.updateIsRecent" id="apidoc.module.crdt.super_.updateIsRecent">module crdt.super_.updateIsRecent</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.super_.updateIsRecent.updateIsRecent" id="apidoc.element.crdt.super_.updateIsRecent.updateIsRecent">
        function <span class="apidocSignatureSpan">crdt.super_.</span>updateIsRecent
        <span class="apidocSignatureSpan">(update, sources)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">updateIsRecent = function (update, sources) {
  var ts = update[1]
  var source = update[2]
  return (!sources || !sources[source] || sources[source] &lt; ts)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.sync" id="apidoc.module.crdt.sync">module crdt.sync</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.sync.sync" id="apidoc.element.crdt.sync.sync">
        function <span class="apidocSignatureSpan">crdt.</span>sync
        <span class="apidocSignatureSpan">(a, b)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function sync(a, b) {
  var as = a.createStream()
  var bs = b.createStream()
  return as.pipe(bs).pipe(as)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.crdt.toString" id="apidoc.module.crdt.toString">module crdt.toString</a></h1>


    <h2>
        <a href="#apidoc.element.crdt.toString.toString" id="apidoc.element.crdt.toString.toString">
        function <span class="apidocSignatureSpan">crdt.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>